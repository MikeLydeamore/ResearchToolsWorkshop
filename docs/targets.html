<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Targets, the make-like pipeline | Reproducibility is you(R) responsibility</title>
  <meta name="description" content="<p>A short workshop-like tutorial in reproducibility and why it is a problem,
and how to help solve it!</p>" />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Targets, the make-like pipeline | Reproducibility is you(R) responsibility" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>A short workshop-like tutorial in reproducibility and why it is a problem,
and how to help solve it!</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Targets, the make-like pipeline | Reproducibility is you(R) responsibility" />
  
  <meta name="twitter:description" content="<p>A short workshop-like tutorial in reproducibility and why it is a problem,
and how to help solve it!</p>" />
  

<meta name="author" content="Michael Lydeamore" />


<meta name="date" content="2022-04-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="renv.html"/>
<link rel="next" href="rmarkdown.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
<script src="libs/vis-9.1.0/vis-network.min.js"></script>
<script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Monash EBS Research Tools Workshop</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Reproducibility and your research<span></span></a>
<ul>
<li class="chapter" data-level="1.0.1" data-path="index.html"><a href="index.html#discussion"><i class="fa fa-check"></i><b>1.0.1</b> Discussion<span></span></a></li>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#there-isnt-a-silver-bullet"><i class="fa fa-check"></i><b>1.1</b> There isn’t a silver bullet<span></span></a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#there-is-more-to-it-than-today"><i class="fa fa-check"></i><b>1.2</b> There is more to it than today…<span></span></a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#today-i-will-cover"><i class="fa fa-check"></i><b>1.3</b> Today I will cover…<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rstudio.html"><a href="rstudio.html"><i class="fa fa-check"></i><b>2</b> RStudio and RStudio Projects<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="rstudio.html"><a href="rstudio.html#rstudio-1"><i class="fa fa-check"></i><b>2.1</b> RStudio<span></span></a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="rstudio.html"><a href="rstudio.html#exercise-2.1"><i class="fa fa-check"></i><b>2.1.1</b> Exercise 2.1<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="rstudio.html"><a href="rstudio.html#rstudio-default-options"><i class="fa fa-check"></i><b>2.2</b> RStudio Default Options<span></span></a></li>
<li class="chapter" data-level="2.3" data-path="rstudio.html"><a href="rstudio.html#rstudio-projects"><i class="fa fa-check"></i><b>2.3</b> Rstudio Projects<span></span></a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="rstudio.html"><a href="rstudio.html#never-use-setwd"><i class="fa fa-check"></i><b>2.3.1</b> Never use <code>setwd()</code>*<span></span></a></li>
<li class="chapter" data-level="2.3.2" data-path="rstudio.html"><a href="rstudio.html#project-structure"><i class="fa fa-check"></i><b>2.3.2</b> Project structure<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="rstudio.html"><a href="rstudio.html#projects-with-a-capital-p"><i class="fa fa-check"></i><b>2.4</b> Projects, with a capital P<span></span></a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="rstudio.html"><a href="rstudio.html#exercise-2.4"><i class="fa fa-check"></i><b>2.4.1</b> Exercise 2.4<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="rstudio.html"><a href="rstudio.html#making-sure-youre-in-the-right-place"><i class="fa fa-check"></i><b>2.5</b> Making sure you’re in the right place<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="renv.html"><a href="renv.html"><i class="fa fa-check"></i><b>3</b> Avoiding dependency hell with <code>renv</code><span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="renv.html"><a href="renv.html#what-is-dependency-hell"><i class="fa fa-check"></i><b>3.1</b> What is dependency hell?<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="renv.html"><a href="renv.html#renv-basics-and-quick-start"><i class="fa fa-check"></i><b>3.2</b> <code>renv</code> basics and quick-start<span></span></a></li>
<li class="chapter" data-level="3.3" data-path="renv.html"><a href="renv.html#what-is-a-lockfile-anyway"><i class="fa fa-check"></i><b>3.3</b> What is a lockfile, anyway?<span></span></a></li>
<li class="chapter" data-level="3.4" data-path="renv.html"><a href="renv.html#practice-time"><i class="fa fa-check"></i><b>3.4</b> Practice time<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="targets.html"><a href="targets.html"><i class="fa fa-check"></i><b>4</b> Targets, the make-like pipeline<span></span></a>
<ul>
<li class="chapter" data-level="4.0.1" data-path="targets.html"><a href="targets.html#exercise"><i class="fa fa-check"></i><b>4.0.1</b> Exercise<span></span></a></li>
<li class="chapter" data-level="4.1" data-path="targets.html"><a href="targets.html#enter-targets"><i class="fa fa-check"></i><b>4.1</b> Enter <code>targets</code><span></span></a></li>
<li class="chapter" data-level="4.2" data-path="targets.html"><a href="targets.html#targets-script-file"><i class="fa fa-check"></i><b>4.2</b> Targets script file<span></span></a></li>
<li class="chapter" data-level="4.3" data-path="targets.html"><a href="targets.html#defining-a-target"><i class="fa fa-check"></i><b>4.3</b> Defining a target<span></span></a></li>
<li class="chapter" data-level="4.4" data-path="targets.html"><a href="targets.html#running-a-pipeline"><i class="fa fa-check"></i><b>4.4</b> Running a pipeline<span></span></a></li>
<li class="chapter" data-level="4.5" data-path="targets.html"><a href="targets.html#working-with-a-target"><i class="fa fa-check"></i><b>4.5</b> Working with a target<span></span></a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="targets.html"><a href="targets.html#exercise-1"><i class="fa fa-check"></i><b>4.5.1</b> Exercise<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="targets.html"><a href="targets.html#function-oriented-programming"><i class="fa fa-check"></i><b>4.6</b> Function-oriented programming<span></span></a></li>
<li class="chapter" data-level="4.7" data-path="targets.html"><a href="targets.html#targets-helps-you-manage-complicated-workflows"><i class="fa fa-check"></i><b>4.7</b> <code>targets</code> helps you manage complicated workflows<span></span></a></li>
<li class="chapter" data-level="4.8" data-path="targets.html"><a href="targets.html#extra-reading"><i class="fa fa-check"></i><b>4.8</b> Extra reading<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>5</b> RMarkdown basics<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="rmarkdown.html"><a href="rmarkdown.html#what-is-rmarkdown"><i class="fa fa-check"></i><b>5.1</b> What is RMarkdown?<span></span></a></li>
<li class="chapter" data-level="5.2" data-path="rmarkdown.html"><a href="rmarkdown.html#the-traditional-writing-process"><i class="fa fa-check"></i><b>5.2</b> The traditional writing process<span></span></a></li>
<li class="chapter" data-level="5.3" data-path="rmarkdown.html"><a href="rmarkdown.html#enter-rmarkdown"><i class="fa fa-check"></i><b>5.3</b> Enter RMarkdown<span></span></a></li>
<li class="chapter" data-level="5.4" data-path="rmarkdown.html"><a href="rmarkdown.html#exercise-2"><i class="fa fa-check"></i><b>5.4</b> Exercise<span></span></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducibility is you(R) responsibility</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="targets" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Targets, the make-like pipeline<a href="targets.html#targets" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The project structure we discussed in Chapter <a href="rstudio.html#rstudio">2</a> works fine for our
reasonably straightforward projects that don’t have too many moving parts.</p>
<p>Often, our analyses will take a long time to run (I’m looking at you Stan) or
are stochastic (again, Stan), and so we don’t want to re-run them every time we
run our pipeline script. But, we need to make sure everything is up to date if
we change something.</p>
<p>For example, I’ve plotted my model fit, but mislabelled my axes. I want to
re-run the plot but not every step of my analysis. How can I make sure
everything is up to date?</p>
<div id="exercise" class="section level3 hasAnchor" number="4.0.1">
<h3><span class="header-section-number">4.0.1</span> Exercise<a href="targets.html#exercise" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>How would you go about keeping only the relevant parts of your script up to
date?</p>
</div>
<div id="enter-targets" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Enter <code>targets</code><a href="targets.html#enter-targets" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Targets borrows it’s workflow pattern from very old tools like <code>Make</code>, to only
run the parts of an analysis that <em>actually</em> need updating.</p>
<p>It uses <em>dynamic programming</em> to look at the set of outputs (known as “targets”)
and determine if they are outdated, and thus only runs the part of the analysis
that needs to be re-run.</p>
<p>First, let’s install targets:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="targets.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;targets&quot;</span>)</span>
<span id="cb15-2"><a href="targets.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;visNetwork&quot;</span>)</span>
<span id="cb15-3"><a href="targets.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span></code></pre></div>
<p>Annoyingly, targets relies on <code>igraph</code> to do a lot of it’s graph-related work
both to visualise the pipeline and work out what is connected to what. <code>igraph</code>
is a very large, very heavy package so give it a few minutes to install. We also
install <code>visNetwork</code> as that will give us some pretty visualisations shortly.</p>
<p>Every <code>targets</code> workflow needs a special <code>_targets.R</code> file. We can create that
by running:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="targets.html#cb16-1" aria-hidden="true" tabindex="-1"></a>targets<span class="sc">::</span><span class="fu">use_targets</span>()</span>
<span id="cb16-2"><a href="targets.html#cb16-2" aria-hidden="true" tabindex="-1"></a>targets<span class="sc">::</span><span class="fu">tar_edit</span>()</span></code></pre></div>
<p>and actually, we can use that second command to edit the this file from
anywhere, so it can be useful to bind it to a key.</p>
</div>
<div id="targets-script-file" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Targets script file<a href="targets.html#targets-script-file" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>After creating, your <code>_targets.R</code> file will look something like this:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="targets.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Created by use_targets().</span></span>
<span id="cb17-2"><a href="targets.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Follow the comments below to fill in this target script.</span></span>
<span id="cb17-3"><a href="targets.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Then follow the manual to check and run the pipeline:</span></span>
<span id="cb17-4"><a href="targets.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   https://books.ropensci.org/targets/walkthrough.html#inspect-the-pipeline # nolint</span></span>
<span id="cb17-5"><a href="targets.html#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="targets.html#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages required to define the pipeline:</span></span>
<span id="cb17-7"><a href="targets.html#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb17-8"><a href="targets.html#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tarchetypes) # Load other packages as needed. # nolint</span></span>
<span id="cb17-9"><a href="targets.html#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="targets.html#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Set target options:</span></span>
<span id="cb17-11"><a href="targets.html#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(</span>
<span id="cb17-12"><a href="targets.html#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">packages =</span> <span class="fu">c</span>(<span class="st">&quot;tibble&quot;</span>), <span class="co"># packages that your targets need to run</span></span>
<span id="cb17-13"><a href="targets.html#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> <span class="st">&quot;rds&quot;</span> <span class="co"># default storage format</span></span>
<span id="cb17-14"><a href="targets.html#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set other options as needed.</span></span>
<span id="cb17-15"><a href="targets.html#cb17-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-16"><a href="targets.html#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="targets.html#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># tar_make_clustermq() configuration (okay to leave alone):</span></span>
<span id="cb17-18"><a href="targets.html#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">clustermq.scheduler =</span> <span class="st">&quot;multicore&quot;</span>)</span>
<span id="cb17-19"><a href="targets.html#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="targets.html#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co"># tar_make_future() configuration (okay to leave alone):</span></span>
<span id="cb17-21"><a href="targets.html#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Install packages {{future}}, {{future.callr}}, and {{future.batchtools}} to allow use_targets() to configure tar_make_future() options.</span></span>
<span id="cb17-22"><a href="targets.html#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="targets.html#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the R scripts with your custom functions:</span></span>
<span id="cb17-24"><a href="targets.html#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (file <span class="cf">in</span> <span class="fu">list.files</span>(<span class="st">&quot;R&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)) <span class="fu">source</span>(file)</span>
<span id="cb17-25"><a href="targets.html#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co"># source(&quot;other_functions.R&quot;) # Source other scripts as needed. # nolint</span></span>
<span id="cb17-26"><a href="targets.html#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="targets.html#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace the target list below with your own:</span></span>
<span id="cb17-28"><a href="targets.html#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb17-29"><a href="targets.html#cb17-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb17-30"><a href="targets.html#cb17-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> data,</span>
<span id="cb17-31"><a href="targets.html#cb17-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">command =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>), <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>))</span>
<span id="cb17-32"><a href="targets.html#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="co">#   format = &quot;feather&quot; # efficient storage of large data frames # nolint</span></span>
<span id="cb17-33"><a href="targets.html#cb17-33" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb17-34"><a href="targets.html#cb17-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb17-35"><a href="targets.html#cb17-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> model,</span>
<span id="cb17-36"><a href="targets.html#cb17-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">command =</span> <span class="fu">coefficients</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data))</span>
<span id="cb17-37"><a href="targets.html#cb17-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-38"><a href="targets.html#cb17-38" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>There’s a bit going on here. The first point of difference from a typical
workflow is that instead of loading packages with <code>library</code>, we set them inside
<code>tar_option_set</code>.</p>
<p>This is because <code>targets</code> runs in a fresh R session (not your current one!) and
will load those packages into each session separately.</p>
<p>The next few lines are focussed on running <code>targets</code> in parallel - helpful but
outside the scope for today.</p>
<p>Then, there is a one-liner that will source all the files in your “R”
subdirectory.</p>
<p>Finally, there’s a list of targets, and this is the juicy part…</p>
</div>
<div id="defining-a-target" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Defining a target<a href="targets.html#defining-a-target" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>All targets must start with a call to <code>tar_target()</code>. This function takes two
arguments:</p>
<ol style="list-style-type: decimal">
<li>A name for the target (call it whatever you like, but make it memorable)</li>
<li>A command to run. This can be any valid R expression, but the <code>targets</code>
authors suggest following <em>functional programming</em>. More on this a bit
later.</li>
</ol>
<p>The example file has two targets. One generates some data, and the second fits a
linear model to said data.</p>
<p>We can see how this works by calling:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="targets.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_visnetwork</span>()</span></code></pre></div>
<div id="htmlwidget-f2f26756399c49929286" style="width:672px;height:480px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-f2f26756399c49929286">{"x":{"nodes":{"name":["data","model","file"],"type":["stem","stem","object"],"status":["outdated","outdated","outdated"],"seconds":[null,null,null],"bytes":[null,null,null],"branches":[null,null,null],"label":["data","model","file"],"color":["#78B7C5","#78B7C5","#78B7C5"],"id":["data","model","file"],"level":[1,2,0],"shape":["dot","dot","triangleDown"]},"edges":{"from":["data"],"to":["model"],"arrows":["to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":1,"to":1},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Stem","Object"],"color":["#78B7C5","#899DA4","#899DA4"],"shape":["dot","dot","triangleDown"]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p>We can see our 2 functions, and the object <code>file</code>, which is produced by the code
which will source our R files. The graph shows us that data feeds into the
model.</p>
</div>
<div id="running-a-pipeline" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Running a pipeline<a href="targets.html#running-a-pipeline" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Running the targets pipeline is straightforward<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="targets.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span></code></pre></div>
<pre><code>## • start target data
## • built target data
## • start target model
## • built target model
## • end pipeline: 0.045 seconds</code></pre>
<p>There’s a bit of output telling you what gets built and what gets skipped. The
first time you run a pipeline, everything will have to be made, but from then
on, only the outdated bits will be run:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="targets.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_make</span>()</span></code></pre></div>
<pre><code>## ✓ skip target data
## ✓ skip target model
## ✓ skip pipeline: 0.031 seconds</code></pre>
</div>
<div id="working-with-a-target" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Working with a target<a href="targets.html#working-with-a-target" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Once your targets are built, you might want to do something with them. For
interactive programming (which includes markdown), we can load the target into
our current environment using <code>tar_load()</code>. For example,</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="targets.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_load</span>(model)</span>
<span id="cb23-2"><a href="targets.html#cb23-2" aria-hidden="true" tabindex="-1"></a>model</span></code></pre></div>
<pre><code>## (Intercept)           x 
##  0.01023539  0.09225038</code></pre>
<p>We can also just print the current value (useful for plots) with <code>tar_read()</code>.</p>
<p>Note that you only need to <code>tar_load</code> or <code>tar_read</code> <em>outside</em> of the targets
workflow. If you’re writing a function to use an input, <em>do not</em> use these
functions, just use the input argument as you normally would, and pass in the
name of the target inside the <code>_targets.R</code> file. For example, if we wanted a
function that worked with our coefficients we would write:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="targets.html#cb25-1" aria-hidden="true" tabindex="-1"></a>transform_slope <span class="ot">&lt;-</span> <span class="cf">function</span>(coefficients, multiplier) {</span>
<span id="cb25-2"><a href="targets.html#cb25-2" aria-hidden="true" tabindex="-1"></a>  coefficients[<span class="dv">2</span>] <span class="sc">*</span> multiplier <span class="co"># Note the lack of tar_load() here!</span></span>
<span id="cb25-3"><a href="targets.html#cb25-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>and then add the following to the end of the <code>_targets.R</code> file:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="targets.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_target</span>(</span>
<span id="cb26-2"><a href="targets.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  transformed_slope,</span>
<span id="cb26-3"><a href="targets.html#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform_slope</span>(model, <span class="dv">3</span>)</span>
<span id="cb26-4"><a href="targets.html#cb26-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div id="exercise-1" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Exercise<a href="targets.html#exercise-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Try adding these features to your targets pipeline and get it to run.</p>
</div>
</div>
<div id="function-oriented-programming" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Function-oriented programming<a href="targets.html#function-oriented-programming" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Technically speaking, <code>tar_target</code> will accept any valid R expression.
Theoretically, this means we never need to write another R function ever again!</p>
<p>But, if we do that, we’ll quickly find our <code>_targets.R</code> file will be incredibly
long. Consider this example from the <code>targets</code> manual:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="targets.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb27-2"><a href="targets.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;R/functions.R&quot;</span>)</span>
<span id="cb27-3"><a href="targets.html#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(<span class="at">packages =</span> <span class="fu">c</span>(<span class="st">&quot;tibble&quot;</span>, <span class="st">&quot;readr&quot;</span>, <span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>))</span>
<span id="cb27-4"><a href="targets.html#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb27-5"><a href="targets.html#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(file, <span class="st">&quot;data.csv&quot;</span>, <span class="at">format =</span> <span class="st">&quot;file&quot;</span>),</span>
<span id="cb27-6"><a href="targets.html#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb27-7"><a href="targets.html#cb27-7" aria-hidden="true" tabindex="-1"></a>    data,</span>
<span id="cb27-8"><a href="targets.html#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(file, <span class="at">col_types =</span> <span class="fu">cols</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb27-9"><a href="targets.html#cb27-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Ozone))</span>
<span id="cb27-10"><a href="targets.html#cb27-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb27-11"><a href="targets.html#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb27-12"><a href="targets.html#cb27-12" aria-hidden="true" tabindex="-1"></a>    model,</span>
<span id="cb27-13"><a href="targets.html#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(Ozone <span class="sc">~</span> Temp, data) <span class="sc">%&gt;%</span></span>
<span id="cb27-14"><a href="targets.html#cb27-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coefficients</span>()</span>
<span id="cb27-15"><a href="targets.html#cb27-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb27-16"><a href="targets.html#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb27-17"><a href="targets.html#cb27-17" aria-hidden="true" tabindex="-1"></a>    plot,</span>
<span id="cb27-18"><a href="targets.html#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(data) <span class="sc">+</span></span>
<span id="cb27-19"><a href="targets.html#cb27-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Temp, <span class="at">y =</span> Ozone)) <span class="sc">+</span></span>
<span id="cb27-20"><a href="targets.html#cb27-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_abline</span>(<span class="at">intercept =</span> model[<span class="dv">1</span>], <span class="at">slope =</span> model[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb27-21"><a href="targets.html#cb27-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_gray</span>(<span class="dv">24</span>)</span>
<span id="cb27-22"><a href="targets.html#cb27-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-23"><a href="targets.html#cb27-23" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>With only three, relatively simple targets, this file is already 18 lines long.
If we instead write each of these targets as their own functions, we can reduce
this file to</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="targets.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb28-2"><a href="targets.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;R/functions.R&quot;</span>)</span>
<span id="cb28-3"><a href="targets.html#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(<span class="at">packages =</span> <span class="fu">c</span>(<span class="st">&quot;tibble&quot;</span>, <span class="st">&quot;readr&quot;</span>, <span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>))</span>
<span id="cb28-4"><a href="targets.html#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb28-5"><a href="targets.html#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(file, <span class="st">&quot;data.csv&quot;</span>, <span class="at">format =</span> <span class="st">&quot;file&quot;</span>),</span>
<span id="cb28-6"><a href="targets.html#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(data, <span class="fu">get_data</span>(file)),</span>
<span id="cb28-7"><a href="targets.html#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(model, <span class="fu">fit_model</span>(data)),</span>
<span id="cb28-8"><a href="targets.html#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(plot, <span class="fu">plot_model</span>(model, data))</span>
<span id="cb28-9"><a href="targets.html#cb28-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Much cleaner.</p>
<p>This makes us write a function for every step in our process, which makes
long-term maintenance of code a lot easier. It might seem cludgy at first (it
was to me), but over time it has led my code to be cleaner and easier to adjust
going forward. I also recommend the rather nice <code>fnmate</code> package (only available
on GitHub) to make writing functions easier as it will auto-generate the
skeletons for you.</p>
</div>
<div id="targets-helps-you-manage-complicated-workflows" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> <code>targets</code> helps you manage complicated workflows<a href="targets.html#targets-helps-you-manage-complicated-workflows" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here is a more complicated workflow from one of my projects:</p>
<p><img src="figures/targets_figure.png" /></p>
<p>You can see how if I update a function somewhere in the middle, it’s not
immediately obvious to me what needs to be updated and when, yet targets will
handle all of this for me. Truly one of my favourite packages.</p>
</div>
<div id="extra-reading" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> Extra reading<a href="targets.html#extra-reading" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <a href="https://books.ropensci.org/targets/">user manual</a> for <code>targets</code> is quite
good.</p>
<p><code>tarchetypes</code> is another good package that makes <code>targets</code> <a href="https://github.com/ropensci/tarchetypes">a bit
nicer</a> to work with.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p>one shouldn’t call
<code>tar_make()</code> inside an Rmd document, as it will get called every time you knit,
which isn’t really ideal.<a href="targets.html#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="renv.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rmarkdown.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/03-targets.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
